<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploy model :: Template Tutorial</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/template-tutorial/02-deploy.html">
    <link rel="prev" href="01-setup.html">
    <link rel="next" href="03-monitor.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://redhat-scholars.github.io/course-template">Template Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="template-tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Template Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#setup-initial-environment">Setup environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#explore-notebooks-and-manage-dependencies">Manage Dependencies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#use-bots.adoc">Use bots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#push-changes">Git extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-deploy.html">2. Deploy Model</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-images">Build Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#deploy-model">Deploy Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#test-model">Test Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#monitor-model">Monitor Model</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-monitor.html">3. Use Pipelines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-monitor.html#create-ai-pipeline">Build Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-monitor.html#run-ai-pipeline">Run Model</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Template Tutorial</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Template Tutorial</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Template Tutorial</a></li>
    <li><a href="02-deploy.html">2. Deploy Model</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/isabelizimm/scholars-template/edit/master/documentation/modules/ROOT/pages/02-deploy.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Deploy model</h1>
<div class="sect1">
<h2 id="build-images"><a class="anchor" href="#build-images"></a>Create a first release and image of your project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sub-sections of step 6 can be performed only if you have
set your project with your pipelines. In order to do that you can
followin these instructions:
<a href="https://github.com/AICoE/aicoe-ci#setting-aicoe-ci-on-github-organizationrepository">Setting
AICoE CI and Thoth on your repo</a>.</p>
</div>
<div class="paragraph">
<p>For the purpose of the tutorial the images required are already created
using these pipelines, therefore here you can find a description on how
they have been created and where they are available.</p>
</div>
<div class="sect2">
<h3 id="_ask_for_new_release"><a class="anchor" href="#_ask_for_new_release"></a>Ask for new release</h3>
<div class="paragraph">
<p>Using pipelines like the AICoE tooling you can rely on bots helping you,
as described above in the initial description. These pipelines are
described in <a href="https://github.com/AICoE/aicoe-ci">AICoE Pipeline</a> and you
can use them for you projects if you are interested.</p>
</div>
<div class="paragraph">
<p>In this case the
<a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/blob/master/.aicoe-ci.yaml">.aicoe.yaml</a>
is created with all information relative to build (e.g. base image,
build strategy, registry where to push) as described in
<a href="https://github.com/AICoE/aicoe-ci">AICoE Pipeline</a> documentation.</p>
</div>
<div class="paragraph">
<p>Some of the pipelines used in Thoth project are maintained by bots.
Therefore you can open an issue asking for release (e.g patch, minor,
major) and the bots will handle your request. One the request will be
completed the bot will automatically close the issue as you can see from
the images below:</p>
</div>
<div class="paragraph">
<p>The <code>CHANGELOG</code> after the release is created using AI model that cluster
pull requests. You can find more information about <code>glyph project</code>
<a href="https://github.com/thoth-station/glyph">here</a>.</p>
</div>
<div class="paragraph">
<p>Once the issue is closed by the bot, a tag is created in the GitHub
project and a pipeline starts in order to build and push the image on
the registry according to the requirements inserted in the
<a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/blob/master/.aicoe-ci.yaml">.aicoe.yaml</a>.</p>
</div>
<div class="paragraph">
<p>Once the new tag is created, Tekton pipelines from the AICoE are
triggered.</p>
</div>
</div>
<div class="sect2">
<h3 id="_image_available_on_quay"><a class="anchor" href="#_image_available_on_quay"></a>Image available on quay</h3>
<div class="paragraph">
<p>Once the image has been created by the Tekton pipeline, you can find it
in your registry (e.g. Quay):</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_of_overlays"><a class="anchor" href="#_use_of_overlays"></a>Use of Overlays</h3>
<div class="paragraph">
<p>If you have overlays directory present, as for this tutorial, you can
perform overlays builds thanks to the
<a href="https://github.com/AICoE/aicoe-ci">AICoE Pipeline</a>. In this way you can
create different images optimized for your steps in pipelines. In this
case the AICoE tooling would create many images as number of overlays,
as you can see from the following images:</p>
</div>
<div class="paragraph">
<p>Once the pipelines are completed the images will be available on quay.</p>
</div>
<div class="paragraph">
<p>You can find the images required for tutorial named after the overlays
requested:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/tree/master/overlays/download-dataset">download-dataset
overlay</a> &#8594; quay.io/thoth-station/elyra-aidevsecops-dataset:v0.5.0
(download-dataset image)</p>
</li>
<li>
<p><a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/tree/master/overlays/training">training
overlay</a> &#8594; quay.io/thoth-station/elyra-aidevsecops-training:v0.5.0
(training image)</p>
</li>
<li>
<p><a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/tree/master/overlays/inference">inference
overlay</a> &#8594; quay.io/thoth-station/elyra-aidevsecops-tutorial:v0.5.0
(inference image)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can check the overlays build requirement in the
<a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/blob/c86ce9c08665c12df0adf829db31bd19e8c61455/.aicoe-ci.yaml#L5">.aicoe.yaml</a>.</p>
</div>
<div class="paragraph">
<p>All requirements for the overlay are created using Thoth resolution
engine, you can find the inputs used for Thoth recommender in the
<a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/blob/bb6fad2441e8df8aa56c2c0e6b5ac45a2cda42eb/.thoth.yaml#L5">.thoth.yaml</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_references"><a class="anchor" href="#_references"></a>References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/AICoE/aicoe-ci">AICoE Pipeline</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-model"><a class="anchor" href="#deploy-model"></a>Deploy your model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are different ways to deploy a model and different tools that can
be used for that (e.g. Seldon, Tf-Serving, TensorRT), but for this
tutorial we created a simple Flask application that can be easily
deployed.</p>
</div>
<div class="sect2">
<h3 id="_flask_application"><a class="anchor" href="#_flask_application"></a>Flask application</h3>
<div class="paragraph">
<p><a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/blob/master/docs/source/model-deployment/flask-application.md">Deploy
Inference Application using Flask</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_kfserving"><a class="anchor" href="#_kfserving"></a>KFServing</h3>
<div class="paragraph">
<p>WIP</p>
</div>
</div>
<div class="sect2">
<h3 id="_tensorrt"><a class="anchor" href="#_tensorrt"></a>TensorRT</h3>
<div class="paragraph">
<p>WIP</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-model"><a class="anchor" href="#test-model"></a>Test inference application deployed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to test your application deployed in the cluster you can run
the
<a href="https://github.com/thoth-station/elyra-aidevsecops-tutorial/tree/master/features">integration
test</a> using <a href="https://behave.readthedocs.io/en/stable/">behave</a> package.</p>
</div>
<div class="paragraph">
<p>Behave uses Behavior-driven development (or BDD), an agile software
development technique that encourages and faciliate collaboration
between developers, QA and non-technical or business participants.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <a href="https://github.com/thoth-station/thamos">thamos</a> using pip:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">  pip install thamos</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create an env and install dependencies using
<a href="https://github.com/thoth-station/thamos">thamos</a> from the root directory
of the tutorial, selecting the appropriate overlays <code>test-model</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">  python3 -m venv venv/ &amp;&amp; . venv/bin/activate &amp;&amp; thamos install -r test-model</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Run <a href="https://behave.readthedocs.io/en/stable/">behave</a> command from the
root directory of the tutorial.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">  DEPLOYED_MODEL_URL=http://elyra-aidevsecops-tutorial-thoth-deployment-examples.apps.zero.massopen.cloud behave</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of the output received:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">  Scenario: Deployment metrics gathering                    # features/gather_deployment_metrics.feature:2
      Given dataset is available                            # features/steps/model_deployment.py:42
      Given deployment is accessible                        # features/steps/model_deployment.py:56
      When I run test to gather metrics on predict endpoint # features/steps/model_deployment.py:72
      Then I should get model and application metrics       # features/steps/model_deployment.py:128

  1 feature passed, 0 failed, 0 skipped
  1 scenario passed, 0 failed, 0 skipped
  4 steps passed, 0 failed, 0 skipped, 0 undefined
  Took 0m3.394s</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Checking metrics produced running</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">  cat metrics.json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">{'average_latency': 0.03846242621075362, 'average_error': 0.001}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_references_2"><a class="anchor" href="#_references_2"></a>References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://behave.readthedocs.io/en/stable/">behave</a></p>
</li>
<li>
<p><a href="https://github.com/thoth-station/thamos">thamos</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitor-model"><a class="anchor" href="#monitor-model"></a>Monitor your model and application with Prometheus and Grafana</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open issue in <a href="https://www.operate-first.cloud/">Operate First</a>
<a href="https://github.com/operate-first/support/issues">support</a> and request
Prometheus scraping the model endpoint <code>/metrics</code> for the application
deployed in your namespace.</p>
</li>
<li>
<p>Create new Grafana dashbord for the metrics to see how the application
and model are performing and open issue in
<a href="https://www.operate-first.cloud/">Operate First</a>
<a href="https://github.com/operate-first/support/issues">support</a> on how to have
your dashboard deployed.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_references_3"><a class="anchor" href="#_references_3"></a>References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.operate-first.cloud/">Operate First</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-setup.html">1. Setup</a></span>
  <span class="next"><a href="03-monitor.html">3. Use Pipelines</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
